{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import\"./Participants.css\";import{connect}from\"react-redux\";import{Participant}from\"./Participant/Participant.component\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Participants=function Participants(props){var videoRef=useRef(null);var participantKey=Object.keys(props.participants);useEffect(function(){if(videoRef.current){videoRef.current.srcObject=props.stream;videoRef.current.muted=true;}},[props.currentUser,props.stream]);var currentUser=props.currentUser?Object.values(props.currentUser)[0]:null;var gridCol=participantKey.length===1?1:participantKey.length<=4?2:4;var gridColSize=participantKey.length<=4?1:2;var gridRowSize=participantKey.length<=4?participantKey.length:Math.ceil(participantKey.length/2);var screenPresenter=participantKey.find(function(element){var currentParticipant=props.participants[element];return currentParticipant.screen;});if(screenPresenter){gridCol=1;gridRowSize=2;}var participants=participantKey.map(function(element,index){var currentParticipant=props.participants[element];var isCurrentUser=currentParticipant.currentUser;if(isCurrentUser){return null;}var pc=currentParticipant.peerConnection;var remoteStream=new MediaStream();var curentIndex=index;if(pc){pc.ontrack=function(event){event.streams[0].getTracks().forEach(function(track){remoteStream.addTrack(track);});var videElement=document.getElementById(\"participantVideo\".concat(curentIndex));if(videElement)videElement.srcObject=remoteStream;};}return/*#__PURE__*/_jsx(Participant,{currentParticipant:currentParticipant,curentIndex:curentIndex,hideVideo:screenPresenter&&screenPresenter!==element// showAvatar={\n//   !currentParticipant.video &&\n//   !currentParticipant.screen &&\n//   currentParticipant.name\n// }\n},curentIndex);});return/*#__PURE__*/_jsxs(\"div\",{style:{\"--grid-size\":gridCol,\"--grid-col-size\":gridColSize,\"--grid-row-size\":gridRowSize},className:\"participants\",children:[participants,/*#__PURE__*/_jsx(Participant,{currentParticipant:currentUser,curentIndex:participantKey.length,hideVideo:screenPresenter&&!currentUser.screen,videoRef:videoRef// showAvatar={currentUser && !currentUser.video && !currentUser.screen}\n,currentUser:true})]});};var mapStateToProps=function mapStateToProps(state){return{participants:state.participants,currentUser:state.currentUser,stream:state.mainStream};};export default connect(mapStateToProps)(Participants);","map":{"version":3,"names":["React","useEffect","useRef","connect","Participant","Participants","props","videoRef","participantKey","Object","keys","participants","current","srcObject","stream","muted","currentUser","values","gridCol","length","gridColSize","gridRowSize","Math","ceil","screenPresenter","find","element","currentParticipant","screen","map","index","isCurrentUser","pc","peerConnection","remoteStream","MediaStream","curentIndex","ontrack","event","streams","getTracks","forEach","track","addTrack","videElement","document","getElementById","mapStateToProps","state","mainStream"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/components/Participants/Participants.component.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport \"./Participants.css\";\r\nimport { connect } from \"react-redux\";\r\nimport { Participant } from \"./Participant/Participant.component\";\r\n\r\nconst Participants = (props) => {\r\n  const videoRef = useRef(null);\r\n  let participantKey = Object.keys(props.participants);\r\n  useEffect(() => {\r\n     \r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = props.stream;\r\n      videoRef.current.muted = true;\r\n    }\r\n  }, [props.currentUser, props.stream]);\r\n\r\n  const currentUser = props.currentUser\r\n    ? Object.values(props.currentUser)[0]\r\n    : null;\r\n\r\n  let gridCol =\r\n    participantKey.length === 1 ? 1 : participantKey.length <= 4 ? 2 : 4;\r\n  const gridColSize = participantKey.length <= 4 ? 1 : 2;\r\n  let gridRowSize =\r\n    participantKey.length <= 4\r\n      ? participantKey.length\r\n      : Math.ceil(participantKey.length / 2);\r\n\r\n  const screenPresenter = participantKey.find((element) => {\r\n    const currentParticipant = props.participants[element];\r\n    return currentParticipant.screen;\r\n  });\r\n\r\n  if (screenPresenter) {\r\n    gridCol = 1;\r\n    gridRowSize = 2;\r\n  }\r\n  const participants = participantKey.map((element, index) => {\r\n    const currentParticipant = props.participants[element];\r\n    const isCurrentUser = currentParticipant.currentUser;\r\n    if (isCurrentUser) {\r\n      return null;\r\n    }\r\n    const pc = currentParticipant.peerConnection;\r\n    const remoteStream = new MediaStream();\r\n    let curentIndex = index;\r\n    if (pc) {\r\n      pc.ontrack = (event) => {\r\n        event.streams[0].getTracks().forEach((track) => {\r\n          remoteStream.addTrack(track);\r\n        });\r\n        const videElement = document.getElementById(\r\n          `participantVideo${curentIndex}`\r\n        );\r\n        if (videElement) videElement.srcObject = remoteStream;\r\n      };\r\n    }\r\n\r\n    return (\r\n      <Participant\r\n        key={curentIndex}\r\n        currentParticipant={currentParticipant}\r\n        curentIndex={curentIndex}\r\n        hideVideo={screenPresenter && screenPresenter !== element}\r\n        // showAvatar={\r\n        //   !currentParticipant.video &&\r\n        //   !currentParticipant.screen &&\r\n        //   currentParticipant.name\r\n        // }\r\n      />\r\n    );\r\n  });\r\n  return (\r\n    <div\r\n      style={{\r\n        \"--grid-size\": gridCol,\r\n        \"--grid-col-size\": gridColSize,\r\n        \"--grid-row-size\": gridRowSize,\r\n      }}\r\n      className={`participants`}\r\n    >\r\n      {participants}\r\n      <Participant\r\n        currentParticipant={currentUser}\r\n        curentIndex={participantKey.length}\r\n        hideVideo={screenPresenter && !currentUser.screen}\r\n        videoRef={videoRef}\r\n        // showAvatar={currentUser && !currentUser.video && !currentUser.screen}\r\n        currentUser={true}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    participants: state.participants,\r\n    currentUser: state.currentUser,\r\n    stream: state.mainStream,\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Participants);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}