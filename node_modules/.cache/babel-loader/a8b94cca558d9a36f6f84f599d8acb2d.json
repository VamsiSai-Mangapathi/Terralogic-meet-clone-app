{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Vamsisai-2994\\\\REACT\\\\google-meet-clone\\\\src\\\\components\\\\MainScreen\\\\MainScreen.component.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from \"react\";\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\nimport Participants from \"../Participants/Participants.component\";\nimport \"./MainScreen.css\";\nimport { connect } from \"react-redux\";\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\nimport Join from \"./../Kyathi/Join\";\nimport firepadRef from \"../../server/firebase\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MainScreen = props => {\n  _s();\n  const isAdmin = window.location.hash === '#init' ? true : false;\n  // const copy= `${window.location.origin}${`/`}${firepadRef.key}`;\n  const copy = `${window.location.origin}+\"?id=\"+${window.location.pathname}`;\n  const [join, setJoin] = useState();\n  useEffect(() => {\n    if (isAdmin) {\n      setJoin(true);\n    }\n  }, []);\n  const closejoinHandler = () => {\n    setJoin(false);\n  };\n  const participantRef = useRef(props.participants);\n  const onMicClick = micEnabled => {\n    if (props.stream) {\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\n      props.updateUser({\n        audio: micEnabled\n      });\n    }\n  };\n  const onVideoClick = videoEnabled => {\n    if (props.stream) {\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\n      props.updateUser({\n        video: videoEnabled\n      });\n    }\n  };\n  useEffect(() => {\n    participantRef.current = props.participants;\n  }, [props.participants]);\n  const updateStream = stream => {\n    for (let key in participantRef.current) {\n      const sender = participantRef.current[key];\n      if (sender.currentUser) continue;\n      const peerConnection = sender.peerConnection.getSenders().find(s => s.track ? s.track.kind === \"video\" : false);\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\n    }\n    props.setMainStream(stream);\n  };\n  const onScreenShareEnd = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    });\n    localStream.getVideoTracks()[0].enabled = Object.values(props.currentUser)[0].video;\n    updateStream(localStream);\n    props.updateUser({\n      screen: false\n    });\n  };\n  const onScreenClick = async () => {\n    let mediaStream;\n    if (navigator.getDisplayMedia) {\n      mediaStream = await navigator.getDisplayMedia({\n        video: true\n      });\n    } else if (navigator.mediaDevices.getDisplayMedia) {\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true\n      });\n    } else {\n      mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          mediaSource: \"screen\"\n        }\n      });\n    }\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\n    updateStream(mediaStream);\n    props.updateUser({\n      screen: true\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-screen\",\n      children: [join && /*#__PURE__*/_jsxDEV(Join, {\n        onclose: closejoinHandler,\n        url: copy\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 18\n      }, this), /*#__PURE__*/_jsxDEV(Participants, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"footer\",\n      children: /*#__PURE__*/_jsxDEV(MeetingFooter, {\n        onScreenClick: onScreenClick,\n        onMicClick: onMicClick,\n        onVideoClick: onVideoClick\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 5\n  }, this);\n};\n_s(MainScreen, \"iIPzzJZWzXs4Vy6b5fOSxVArI9g=\");\n_c = MainScreen;\nconst mapStateToProps = state => {\n  return {\n    stream: state.mainStream,\n    participants: state.participants,\n    currentUser: state.currentUser\n  };\n};\nconst mapDispatchToProps = dispatch => {\n  return {\n    setMainStream: stream => dispatch(setMainStream(stream)),\n    updateUser: user => dispatch(updateUser(user))\n  };\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\nvar _c;\n$RefreshReg$(_c, \"MainScreen\");","map":{"version":3,"names":["React","useRef","useEffect","useState","MeetingFooter","Participants","connect","setMainStream","updateUser","Join","firepadRef","MainScreen","props","isAdmin","window","location","hash","copy","origin","pathname","join","setJoin","closejoinHandler","participantRef","participants","onMicClick","micEnabled","stream","getAudioTracks","enabled","audio","onVideoClick","videoEnabled","getVideoTracks","video","current","updateStream","key","sender","currentUser","peerConnection","getSenders","find","s","track","kind","replaceTrack","onScreenShareEnd","localStream","navigator","mediaDevices","getUserMedia","Object","values","screen","onScreenClick","mediaStream","getDisplayMedia","mediaSource","onended","mapStateToProps","state","mainStream","mapDispatchToProps","dispatch","user"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/components/MainScreen/MainScreen.component.js"],"sourcesContent":["import React, { useRef, useEffect,useState } from \"react\";\r\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\r\nimport Participants from \"../Participants/Participants.component\";\r\nimport \"./MainScreen.css\";\r\nimport { connect } from \"react-redux\";\r\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\r\nimport Join from \"./../Kyathi/Join\";\r\nimport firepadRef from \"../../server/firebase\";\r\nconst MainScreen = (props) => {\r\n  const isAdmin = window.location.hash === '#init' ? true : false;\r\n  // const copy= `${window.location.origin}${`/`}${firepadRef.key}`;\r\n  const copy=`${window.location.origin}+\"?id=\"+${window.location.pathname}`\r\n  const[join,setJoin]=useState();\r\n\r\n  useEffect(()=>{\r\n    if(isAdmin){\r\n     setJoin(true);\r\n    }\r\n  },[]);\r\n\r\n\r\nconst closejoinHandler=()=>{\r\n    setJoin(false);\r\n}\r\n  const participantRef = useRef(props.participants);\r\n\r\n  const onMicClick = (micEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\r\n      props.updateUser({ audio: micEnabled });\r\n    }\r\n  };\r\n  const onVideoClick = (videoEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\r\n      props.updateUser({ video: videoEnabled });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    participantRef.current = props.participants;\r\n  }, [props.participants]);\r\n\r\n  const updateStream = (stream) => {\r\n    for (let key in participantRef.current) {\r\n      const sender = participantRef.current[key];\r\n      if (sender.currentUser) continue;\r\n      const peerConnection = sender.peerConnection\r\n        .getSenders()\r\n        .find((s) => (s.track ? s.track.kind === \"video\" : false));\r\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\r\n    }\r\n    props.setMainStream(stream);\r\n  };\r\n\r\n  const onScreenShareEnd = async () => {\r\n    const localStream = await navigator.mediaDevices.getUserMedia({\r\n      audio: true,\r\n      video: true,\r\n    });\r\n\r\n    localStream.getVideoTracks()[0].enabled = Object.values(\r\n      props.currentUser\r\n    )[0].video;\r\n\r\n    updateStream(localStream);\r\n\r\n    props.updateUser({ screen: false });\r\n  };\r\n\r\n  const onScreenClick = async () => {\r\n    let mediaStream;\r\n    if (navigator.getDisplayMedia) {\r\n      mediaStream = await navigator.getDisplayMedia({ video: true });\r\n    } else if (navigator.mediaDevices.getDisplayMedia) {\r\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\r\n        video: true,\r\n      });\r\n    } else {\r\n      mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { mediaSource: \"screen\" },\r\n      });\r\n    }\r\n\r\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\r\n\r\n    updateStream(mediaStream);\r\n\r\n    props.updateUser({ screen: true });\r\n  };\r\n  return (\r\n    <div className=\"wrapper\">\r\n      <div className=\"main-screen\">\r\n        {join && <Join onclose={closejoinHandler} url={copy} />}\r\n        <Participants />\r\n      </div>\r\n\r\n      <div className=\"footer\">\r\n        <MeetingFooter\r\n          onScreenClick={onScreenClick}\r\n          onMicClick={onMicClick}\r\n          onVideoClick={onVideoClick}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    stream: state.mainStream,\r\n    participants: state.participants,\r\n    currentUser: state.currentUser,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\r\n    updateUser: (user) => dispatch(updateUser(user)),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}