{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import firepadRef from\"./firebase\";import{store}from\"../index\";var participantRef=firepadRef.child(\"participants\");export var updatePreference=function updatePreference(userId,preference){var currentParticipantRef=participantRef.child(userId).child(\"preferences\");setTimeout(function(){currentParticipantRef.update(preference);});};export var createOffer=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(peerConnection,receiverId,createdID){var currentParticipantRef,offerDescription,offer;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentParticipantRef=participantRef.child(receiverId);peerConnection.onicecandidate=function(event){event.candidate&&currentParticipantRef.child(\"offerCandidates\").push(_objectSpread(_objectSpread({},event.candidate.toJSON()),{},{userId:createdID}));};_context.next=4;return peerConnection.createOffer();case 4:offerDescription=_context.sent;_context.next=7;return peerConnection.setLocalDescription(offerDescription);case 7:offer={sdp:offerDescription.sdp,type:offerDescription.type,userId:createdID};_context.next=10;return currentParticipantRef.child(\"offers\").push().set({offer:offer});case 10:case\"end\":return _context.stop();}}},_callee);}));return function createOffer(_x,_x2,_x3){return _ref.apply(this,arguments);};}();export var initializeListensers=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userId){var currentUserRef;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:currentUserRef=participantRef.child(userId);currentUserRef.child(\"offers\").on(\"child_added\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(snapshot){var data,pc;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=snapshot.val();if(!(data===null||data===void 0?void 0:data.offer)){_context2.next=7;break;}pc=store.getState().participants[data.offer.userId].peerConnection;_context2.next=5;return pc.setRemoteDescription(new RTCSessionDescription(data.offer));case 5:_context2.next=7;return createAnswer(data.offer.userId,userId);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x5){return _ref3.apply(this,arguments);};}());currentUserRef.child(\"offerCandidates\").on(\"child_added\",function(snapshot){var data=snapshot.val();if(data.userId){var pc=store.getState().participants[data.userId].peerConnection;pc.addIceCandidate(new RTCIceCandidate(data));}});currentUserRef.child(\"answers\").on(\"child_added\",function(snapshot){var data=snapshot.val();if(data===null||data===void 0?void 0:data.answer){var pc=store.getState().participants[data.answer.userId].peerConnection;var answerDescription=new RTCSessionDescription(data.answer);pc.setRemoteDescription(answerDescription);}});currentUserRef.child(\"answerCandidates\").on(\"child_added\",function(snapshot){var data=snapshot.val();if(data.userId){var pc=store.getState().participants[data.userId].peerConnection;pc.addIceCandidate(new RTCIceCandidate(data));}});case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function initializeListensers(_x4){return _ref2.apply(this,arguments);};}();var createAnswer=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(otherUserId,userId){var pc,participantRef1,answerDescription,answer;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:pc=store.getState().participants[otherUserId].peerConnection;participantRef1=participantRef.child(otherUserId);pc.onicecandidate=function(event){event.candidate&&participantRef1.child(\"answerCandidates\").push(_objectSpread(_objectSpread({},event.candidate.toJSON()),{},{userId:userId}));};_context4.next=5;return pc.createAnswer();case 5:answerDescription=_context4.sent;_context4.next=8;return pc.setLocalDescription(answerDescription);case 8:answer={type:answerDescription.type,sdp:answerDescription.sdp,userId:userId};_context4.next=11;return participantRef1.child(\"answers\").push().set({answer:answer});case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function createAnswer(_x6,_x7){return _ref4.apply(this,arguments);};}();","map":{"version":3,"names":["firepadRef","store","participantRef","child","updatePreference","userId","preference","currentParticipantRef","setTimeout","update","createOffer","peerConnection","receiverId","createdID","onicecandidate","event","candidate","push","toJSON","offerDescription","setLocalDescription","offer","sdp","type","set","initializeListensers","currentUserRef","on","snapshot","data","val","pc","getState","participants","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","answer","answerDescription","otherUserId","participantRef1"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/server/peerConnection.js"],"sourcesContent":["import firepadRef from \"./firebase\";\r\nimport { store } from \"../index\";\r\n\r\nconst participantRef = firepadRef.child(\"participants\");\r\n\r\nexport const updatePreference = (userId, preference) => {\r\n  const currentParticipantRef = participantRef\r\n    .child(userId)\r\n    .child(\"preferences\");\r\n  setTimeout(() => {\r\n    currentParticipantRef.update(preference);\r\n  });\r\n};\r\n\r\nexport const createOffer = async (peerConnection, receiverId, createdID) => {\r\n  const currentParticipantRef = participantRef.child(receiverId);\r\n  peerConnection.onicecandidate = (event) => {\r\n    event.candidate &&\r\n      currentParticipantRef\r\n        .child(\"offerCandidates\")\r\n        .push({ ...event.candidate.toJSON(), userId: createdID });\r\n  };\r\n\r\n  const offerDescription = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offerDescription);\r\n\r\n  const offer = {\r\n    sdp: offerDescription.sdp,\r\n    type: offerDescription.type,\r\n    userId: createdID,\r\n  };\r\n\r\n  await currentParticipantRef.child(\"offers\").push().set({ offer });\r\n};\r\n\r\nexport const initializeListensers = async (userId) => {\r\n  const currentUserRef = participantRef.child(userId);\r\n\r\n  currentUserRef.child(\"offers\").on(\"child_added\", async (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data?.offer) {\r\n      const pc =\r\n        store.getState().participants[data.offer.userId].peerConnection;\r\n      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\r\n      await createAnswer(data.offer.userId, userId);\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"offerCandidates\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data.userId) {\r\n      const pc = store.getState().participants[data.userId].peerConnection;\r\n      pc.addIceCandidate(new RTCIceCandidate(data));\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"answers\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data?.answer) {\r\n      const pc =\r\n        store.getState().participants[data.answer.userId].peerConnection;\r\n      const answerDescription = new RTCSessionDescription(data.answer);\r\n      pc.setRemoteDescription(answerDescription);\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"answerCandidates\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data.userId) {\r\n      const pc = store.getState().participants[data.userId].peerConnection;\r\n      pc.addIceCandidate(new RTCIceCandidate(data));\r\n    }\r\n  });\r\n};\r\n\r\nconst createAnswer = async (otherUserId, userId) => {\r\n  const pc = store.getState().participants[otherUserId].peerConnection;\r\n  const participantRef1 = participantRef.child(otherUserId);\r\n  pc.onicecandidate = (event) => {\r\n    event.candidate &&\r\n      participantRef1\r\n        .child(\"answerCandidates\")\r\n        .push({ ...event.candidate.toJSON(), userId: userId });\r\n  };\r\n\r\n  const answerDescription = await pc.createAnswer();\r\n  await pc.setLocalDescription(answerDescription);\r\n\r\n  const answer = {\r\n    type: answerDescription.type,\r\n    sdp: answerDescription.sdp,\r\n    userId: userId,\r\n  };\r\n\r\n  await participantRef1.child(\"answers\").push().set({ answer });\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}