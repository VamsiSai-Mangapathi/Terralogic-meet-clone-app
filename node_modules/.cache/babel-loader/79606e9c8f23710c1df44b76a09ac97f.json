{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Vamsisai-2994/REACT/google-meet-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from\"react\";import MeetingFooter from\"../MeetingFooter/MeetingFooter.component\";import Participants from\"../Participants/Participants.component\";import\"./MainScreen.css\";import{connect}from\"react-redux\";import{setMainStream as _setMainStream,updateUser as _updateUser}from\"../../store/actioncreator\";import Join from\"./../Kyathi/Join\";import firepadRef from\"../../server/firebase\";import{useHistory}from\"react-router-dom\";import Welcome from\"./Welcome\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MainScreen=function MainScreen(props){var isAdmin=window.location.hash==='#init'?true:false;var copy=\"\".concat(window.location.origin,\"/login/?id=\").concat(firepadRef.key);var _useState=useState(),_useState2=_slicedToArray(_useState,2),join=_useState2[0],setJoin=_useState2[1];window.localStorage.setItem(\"url\",copy);var history=useHistory();// const [welcome,setwelcome]=useState(window.localStorage.getItem(\"refresh\"));\nuseEffect(function(){if(isAdmin){setJoin(true);}// else{\n//   setwelcome(true);\n// }\n},[]);// history.go(1);\nfunction reloadPage(){// The last \"domLoading\" Time //\nvar currentDocumentTimestamp=new Date(performance.timing.domLoading).getTime();// Current Time //\nvar now=Date.now();// Ten Seconds //\nvar tenSec=10*1000;// Plus Ten Seconds //\nvar plusTenSec=currentDocumentTimestamp+tenSec;if(now>plusTenSec){window.location.reload();}else{}}reloadPage();var closejoinHandler=function closejoinHandler(){setJoin(false);};// const closewelcomehandler=()=>{\n//   window.location.reload(true);\n//   window.localStorage.setItem(\"refresh\",false);\n//   setwelcome(false);\n// }\nvar participantRef=useRef(props.participants);var onMicClick=function onMicClick(micEnabled){if(props.stream){props.stream.getAudioTracks()[0].enabled=micEnabled;props.updateUser({audio:micEnabled});}};var onVideoClick=function onVideoClick(videoEnabled){if(props.stream){props.stream.getVideoTracks()[0].enabled=videoEnabled;props.updateUser({video:videoEnabled});}};useEffect(function(){participantRef.current=props.participants;},[props.participants]);var updateStream=function updateStream(stream){for(var key in participantRef.current){var sender=participantRef.current[key];if(sender.currentUser)continue;var peerConnection=sender.peerConnection.getSenders().find(function(s){return s.track?s.track.kind===\"video\":false;});peerConnection.replaceTrack(stream.getVideoTracks()[0]);}props.setMainStream(stream);};var onScreenShareEnd=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var localStream;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.mediaDevices.getUserMedia({audio:true,video:true});case 2:localStream=_context.sent;localStream.getVideoTracks()[0].enabled=Object.values(props.currentUser)[0].video;updateStream(localStream);props.updateUser({screen:false});case 6:case\"end\":return _context.stop();}}},_callee);}));return function onScreenShareEnd(){return _ref.apply(this,arguments);};}();var onScreenClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var mediaStream;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!navigator.getDisplayMedia){_context2.next=6;break;}_context2.next=3;return navigator.getDisplayMedia({video:true});case 3:mediaStream=_context2.sent;_context2.next=15;break;case 6:if(!navigator.mediaDevices.getDisplayMedia){_context2.next=12;break;}_context2.next=9;return navigator.mediaDevices.getDisplayMedia({video:true});case 9:mediaStream=_context2.sent;_context2.next=15;break;case 12:_context2.next=14;return navigator.mediaDevices.getUserMedia({video:{mediaSource:\"screen\"}});case 14:mediaStream=_context2.sent;case 15:mediaStream.getVideoTracks()[0].onended=onScreenShareEnd;updateStream(mediaStream);props.updateUser({screen:true});case 18:case\"end\":return _context2.stop();}}},_callee2);}));return function onScreenClick(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-screen\",children:[join&&/*#__PURE__*/_jsx(Join,{onclose:closejoinHandler,url:copy}),/*#__PURE__*/_jsx(Participants,{})]}),/*#__PURE__*/_jsx(\"div\",{className:\"footer\",children:/*#__PURE__*/_jsx(MeetingFooter,{onScreenClick:onScreenClick,onMicClick:onMicClick,onVideoClick:onVideoClick})})]});};var mapStateToProps=function mapStateToProps(state){return{stream:state.mainStream,participants:state.participants,currentUser:state.currentUser};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{setMainStream:function setMainStream(stream){return dispatch(_setMainStream(stream));},updateUser:function updateUser(user){return dispatch(_updateUser(user));}};};export default connect(mapStateToProps,mapDispatchToProps)(MainScreen);","map":{"version":3,"names":["React","useRef","useEffect","useState","MeetingFooter","Participants","connect","setMainStream","updateUser","Join","firepadRef","useHistory","Welcome","MainScreen","props","isAdmin","window","location","hash","copy","origin","key","join","setJoin","localStorage","setItem","history","reloadPage","currentDocumentTimestamp","Date","performance","timing","domLoading","getTime","now","tenSec","plusTenSec","reload","closejoinHandler","participantRef","participants","onMicClick","micEnabled","stream","getAudioTracks","enabled","audio","onVideoClick","videoEnabled","getVideoTracks","video","current","updateStream","sender","currentUser","peerConnection","getSenders","find","s","track","kind","replaceTrack","onScreenShareEnd","navigator","mediaDevices","getUserMedia","localStream","Object","values","screen","onScreenClick","getDisplayMedia","mediaStream","mediaSource","onended","mapStateToProps","state","mainStream","mapDispatchToProps","dispatch","user"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/components/MainScreen/MainScreen.component.js"],"sourcesContent":["import React, { useRef, useEffect,useState } from \"react\";\r\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\r\nimport Participants from \"../Participants/Participants.component\";\r\nimport \"./MainScreen.css\";\r\nimport { connect } from \"react-redux\";\r\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\r\nimport Join from \"./../Kyathi/Join\";\r\nimport firepadRef from \"../../server/firebase\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport Welcome from \"./Welcome\";\r\nconst MainScreen = (props) => {\r\n  const isAdmin = window.location.hash === '#init' ? true : false;\r\n  const copy= `${window.location.origin}${`/login/?id=`}${firepadRef.key}`;\r\n  const[join,setJoin]=useState();\r\n  window.localStorage.setItem(\"url\",copy);\r\n  const history=useHistory();\r\n  // const [welcome,setwelcome]=useState(window.localStorage.getItem(\"refresh\"));\r\n  useEffect(()=>{\r\n    \r\n    if(isAdmin){\r\n     setJoin(true);\r\n    }\r\n    // else{\r\n    //   setwelcome(true);\r\n    // }\r\n  },[]);\r\n\r\n  // history.go(1);\r\n  function reloadPage() {\r\n    // The last \"domLoading\" Time //\r\n    var currentDocumentTimestamp =\r\n    new Date(performance.timing.domLoading).getTime();\r\n    // Current Time //\r\n    var now = Date.now();\r\n    // Ten Seconds //\r\n    var tenSec = 10 * 1000;\r\n    // Plus Ten Seconds //\r\n    var plusTenSec = currentDocumentTimestamp + tenSec;\r\n    if (now > plusTenSec) {\r\n    window.location.reload();\r\n    } else {}\r\n  }\r\n  reloadPage();\r\n  const closejoinHandler=()=>{\r\n    setJoin(false);\r\n  }\r\n\r\n  // const closewelcomehandler=()=>{\r\n  //   window.location.reload(true);\r\n  //   window.localStorage.setItem(\"refresh\",false);\r\n  //   setwelcome(false);\r\n  // }\r\n  const participantRef = useRef(props.participants);\r\n\r\n  const onMicClick = (micEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\r\n      props.updateUser({ audio: micEnabled });\r\n    }\r\n  };\r\n  const onVideoClick = (videoEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\r\n      props.updateUser({ video: videoEnabled });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    participantRef.current = props.participants;\r\n  }, [props.participants]);\r\n\r\n  const updateStream = (stream) => {\r\n    for (let key in participantRef.current) {\r\n      const sender = participantRef.current[key];\r\n      if (sender.currentUser) continue;\r\n      const peerConnection = sender.peerConnection\r\n        .getSenders()\r\n        .find((s) => (s.track ? s.track.kind === \"video\" : false));\r\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\r\n    }\r\n    props.setMainStream(stream);\r\n  };\r\n\r\n  const onScreenShareEnd = async () => {\r\n    const localStream = await navigator.mediaDevices.getUserMedia({\r\n      audio: true,\r\n      video: true,\r\n    });\r\n\r\n    localStream.getVideoTracks()[0].enabled = Object.values(\r\n      props.currentUser\r\n    )[0].video;\r\n\r\n    updateStream(localStream);\r\n\r\n    props.updateUser({ screen: false });\r\n  };\r\n\r\n  const onScreenClick = async () => {\r\n    let mediaStream;\r\n    if (navigator.getDisplayMedia) {\r\n      mediaStream = await navigator.getDisplayMedia({ video: true });\r\n    } else if (navigator.mediaDevices.getDisplayMedia) {\r\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\r\n        video: true,\r\n      });\r\n    } else {\r\n      mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { mediaSource: \"screen\" },\r\n      });\r\n    }\r\n\r\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\r\n\r\n    updateStream(mediaStream);\r\n\r\n    props.updateUser({ screen: true });\r\n  };\r\n  return (\r\n    <div className=\"wrapper\">\r\n      <div className=\"main-screen\">\r\n        {join && <Join onclose={closejoinHandler} url={copy} />}\r\n        {/* {welcome && <Welcome onclosewelcome={closewelcomehandler} /> } */}\r\n        <Participants />\r\n      </div>\r\n\r\n      <div className=\"footer\">\r\n        <MeetingFooter\r\n          onScreenClick={onScreenClick}\r\n          onMicClick={onMicClick}\r\n          onVideoClick={onVideoClick}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    stream: state.mainStream,\r\n    participants: state.participants,\r\n    currentUser: state.currentUser,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\r\n    updateUser: (user) => dispatch(updateUser(user)),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\r\n"],"mappings":"4eAAA,MAAOA,MAAK,EAAIC,MAAM,CAAEC,SAAS,CAACC,QAAQ,KAAQ,OAAO,CACzD,MAAOC,cAAa,KAAM,0CAA0C,CACpE,MAAOC,aAAY,KAAM,wCAAwC,CACjE,MAAO,kBAAkB,CACzB,OAASC,OAAO,KAAQ,aAAa,CACrC,OAASC,aAAa,GAAbA,eAAa,CAAEC,UAAU,GAAVA,YAAU,KAAQ,2BAA2B,CACrE,MAAOC,KAAI,KAAM,kBAAkB,CACnC,MAAOC,WAAU,KAAM,uBAAuB,CAC9C,OAAQC,UAAU,KAAO,kBAAkB,CAC3C,MAAOC,QAAO,KAAM,WAAW,CAAC,wFAChC,GAAMC,WAAU,CAAG,QAAbA,WAAU,CAAIC,KAAK,CAAK,CAC5B,GAAMC,QAAO,CAAGC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAK,OAAO,CAAG,IAAI,CAAG,KAAK,CAC/D,GAAMC,KAAI,WAAKH,MAAM,CAACC,QAAQ,CAACG,MAAM,uBAAmBV,UAAU,CAACW,GAAG,CAAE,CACxE,cAAoBlB,QAAQ,EAAE,wCAAxBmB,IAAI,eAACC,OAAO,eAClBP,MAAM,CAACQ,YAAY,CAACC,OAAO,CAAC,KAAK,CAACN,IAAI,CAAC,CACvC,GAAMO,QAAO,CAACf,UAAU,EAAE,CAC1B;AACAT,SAAS,CAAC,UAAI,CAEZ,GAAGa,OAAO,CAAC,CACVQ,OAAO,CAAC,IAAI,CAAC,CACd,CACA;AACA;AACA;AACF,CAAC,CAAC,EAAE,CAAC,CAEL;AACA,QAASI,WAAU,EAAG,CACpB;AACA,GAAIC,yBAAwB,CAC5B,GAAIC,KAAI,CAACC,WAAW,CAACC,MAAM,CAACC,UAAU,CAAC,CAACC,OAAO,EAAE,CACjD;AACA,GAAIC,IAAG,CAAGL,IAAI,CAACK,GAAG,EAAE,CACpB;AACA,GAAIC,OAAM,CAAG,EAAE,CAAG,IAAI,CACtB;AACA,GAAIC,WAAU,CAAGR,wBAAwB,CAAGO,MAAM,CAClD,GAAID,GAAG,CAAGE,UAAU,CAAE,CACtBpB,MAAM,CAACC,QAAQ,CAACoB,MAAM,EAAE,CACxB,CAAC,IAAM,CAAC,CACV,CACAV,UAAU,EAAE,CACZ,GAAMW,iBAAgB,CAAC,QAAjBA,iBAAgB,EAAK,CACzBf,OAAO,CAAC,KAAK,CAAC,CAChB,CAAC,CAED;AACA;AACA;AACA;AACA;AACA,GAAMgB,eAAc,CAAGtC,MAAM,CAACa,KAAK,CAAC0B,YAAY,CAAC,CAEjD,GAAMC,WAAU,CAAG,QAAbA,WAAU,CAAIC,UAAU,CAAK,CACjC,GAAI5B,KAAK,CAAC6B,MAAM,CAAE,CAChB7B,KAAK,CAAC6B,MAAM,CAACC,cAAc,EAAE,CAAC,CAAC,CAAC,CAACC,OAAO,CAAGH,UAAU,CACrD5B,KAAK,CAACN,UAAU,CAAC,CAAEsC,KAAK,CAAEJ,UAAW,CAAC,CAAC,CACzC,CACF,CAAC,CACD,GAAMK,aAAY,CAAG,QAAfA,aAAY,CAAIC,YAAY,CAAK,CACrC,GAAIlC,KAAK,CAAC6B,MAAM,CAAE,CAChB7B,KAAK,CAAC6B,MAAM,CAACM,cAAc,EAAE,CAAC,CAAC,CAAC,CAACJ,OAAO,CAAGG,YAAY,CACvDlC,KAAK,CAACN,UAAU,CAAC,CAAE0C,KAAK,CAAEF,YAAa,CAAC,CAAC,CAC3C,CACF,CAAC,CAED9C,SAAS,CAAC,UAAM,CACdqC,cAAc,CAACY,OAAO,CAAGrC,KAAK,CAAC0B,YAAY,CAC7C,CAAC,CAAE,CAAC1B,KAAK,CAAC0B,YAAY,CAAC,CAAC,CAExB,GAAMY,aAAY,CAAG,QAAfA,aAAY,CAAIT,MAAM,CAAK,CAC/B,IAAK,GAAItB,IAAG,GAAIkB,eAAc,CAACY,OAAO,CAAE,CACtC,GAAME,OAAM,CAAGd,cAAc,CAACY,OAAO,CAAC9B,GAAG,CAAC,CAC1C,GAAIgC,MAAM,CAACC,WAAW,CAAE,SACxB,GAAMC,eAAc,CAAGF,MAAM,CAACE,cAAc,CACzCC,UAAU,EAAE,CACZC,IAAI,CAAC,SAACC,CAAC,QAAMA,EAAC,CAACC,KAAK,CAAGD,CAAC,CAACC,KAAK,CAACC,IAAI,GAAK,OAAO,CAAG,KAAK,EAAC,CAAC,CAC5DL,cAAc,CAACM,YAAY,CAAClB,MAAM,CAACM,cAAc,EAAE,CAAC,CAAC,CAAC,CAAC,CACzD,CACAnC,KAAK,CAACP,aAAa,CAACoC,MAAM,CAAC,CAC7B,CAAC,CAED,GAAMmB,iBAAgB,0FAAG,yKACGC,UAAS,CAACC,YAAY,CAACC,YAAY,CAAC,CAC5DnB,KAAK,CAAE,IAAI,CACXI,KAAK,CAAE,IACT,CAAC,CAAC,QAHIgB,WAAW,eAKjBA,WAAW,CAACjB,cAAc,EAAE,CAAC,CAAC,CAAC,CAACJ,OAAO,CAAGsB,MAAM,CAACC,MAAM,CACrDtD,KAAK,CAACwC,WAAW,CAClB,CAAC,CAAC,CAAC,CAACJ,KAAK,CAEVE,YAAY,CAACc,WAAW,CAAC,CAEzBpD,KAAK,CAACN,UAAU,CAAC,CAAE6D,MAAM,CAAE,KAAM,CAAC,CAAC,CAAC,sDACrC,kBAbKP,iBAAgB,0CAarB,CAED,GAAMQ,cAAa,2FAAG,4JAEhBP,SAAS,CAACQ,eAAe,iDACPR,UAAS,CAACQ,eAAe,CAAC,CAAErB,KAAK,CAAE,IAAK,CAAC,CAAC,QAA9DsB,WAAW,mDACFT,SAAS,CAACC,YAAY,CAACO,eAAe,kDAC3BR,UAAS,CAACC,YAAY,CAACO,eAAe,CAAC,CACzDrB,KAAK,CAAE,IACT,CAAC,CAAC,QAFFsB,WAAW,wEAIST,UAAS,CAACC,YAAY,CAACC,YAAY,CAAC,CACtDf,KAAK,CAAE,CAAEuB,WAAW,CAAE,QAAS,CACjC,CAAC,CAAC,SAFFD,WAAW,wBAKbA,WAAW,CAACvB,cAAc,EAAE,CAAC,CAAC,CAAC,CAACyB,OAAO,CAAGZ,gBAAgB,CAE1DV,YAAY,CAACoB,WAAW,CAAC,CAEzB1D,KAAK,CAACN,UAAU,CAAC,CAAE6D,MAAM,CAAE,IAAK,CAAC,CAAC,CAAC,yDACpC,kBAnBKC,cAAa,2CAmBlB,CACD,mBACE,aAAK,SAAS,CAAC,SAAS,wBACtB,aAAK,SAAS,CAAC,aAAa,WACzBhD,IAAI,eAAI,KAAC,IAAI,EAAC,OAAO,CAAEgB,gBAAiB,CAAC,GAAG,CAAEnB,IAAK,EAAG,cAEvD,KAAC,YAAY,IAAG,GACZ,cAEN,YAAK,SAAS,CAAC,QAAQ,uBACrB,KAAC,aAAa,EACZ,aAAa,CAAEmD,aAAc,CAC7B,UAAU,CAAE7B,UAAW,CACvB,YAAY,CAAEM,YAAa,EAC3B,EACE,GACF,CAEV,CAAC,CAED,GAAM4B,gBAAe,CAAG,QAAlBA,gBAAe,CAAIC,KAAK,CAAK,CACjC,MAAO,CACLjC,MAAM,CAAEiC,KAAK,CAACC,UAAU,CACxBrC,YAAY,CAAEoC,KAAK,CAACpC,YAAY,CAChCc,WAAW,CAAEsB,KAAK,CAACtB,WACrB,CAAC,CACH,CAAC,CAED,GAAMwB,mBAAkB,CAAG,QAArBA,mBAAkB,CAAIC,QAAQ,CAAK,CACvC,MAAO,CACLxE,aAAa,CAAE,uBAACoC,MAAM,QAAKoC,SAAQ,CAACxE,cAAa,CAACoC,MAAM,CAAC,CAAC,GAC1DnC,UAAU,CAAE,oBAACwE,IAAI,QAAKD,SAAQ,CAACvE,WAAU,CAACwE,IAAI,CAAC,CAAC,EAClD,CAAC,CACH,CAAC,CAED,cAAe1E,QAAO,CAACqE,eAAe,CAAEG,kBAAkB,CAAC,CAACjE,UAAU,CAAC"},"metadata":{},"sourceType":"module"}