{"ast":null,"code":"import firepadRef from \"./firebase\";\nimport { store } from \"../index\";\nconst participantRef = firepadRef.child(\"participants\");\nexport const updatePreference = (userId, preference) => {\n  const currentParticipantRef = participantRef.child(userId).child(\"preferences\");\n  setTimeout(() => {\n    currentParticipantRef.update(preference);\n  });\n};\nexport const createOffer = async (peerConnection, receiverId, createdID) => {\n  const currentParticipantRef = participantRef.child(receiverId);\n  peerConnection.onicecandidate = event => {\n    event.candidate && currentParticipantRef.child(\"offerCandidates\").push({\n      ...event.candidate.toJSON(),\n      userId: createdID\n    });\n  };\n  const offerDescription = await peerConnection.createOffer();\n  await peerConnection.setLocalDescription(offerDescription);\n  const offer = {\n    sdp: offerDescription.sdp,\n    type: offerDescription.type,\n    userId: createdID\n  };\n  await currentParticipantRef.child(\"offers\").push().set({\n    offer\n  });\n};\nexport const initializeListensers = async userId => {\n  const currentUserRef = participantRef.child(userId);\n  currentUserRef.child(\"offers\").on(\"child_added\", async snapshot => {\n    const data = snapshot.val();\n    if (data === null || data === void 0 ? void 0 : data.offer) {\n      const pc = store.getState().participants[data.offer.userId].peerConnection;\n      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\n      await createAnswer(data.offer.userId, userId);\n    }\n  });\n  currentUserRef.child(\"offerCandidates\").on(\"child_added\", snapshot => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n  currentUserRef.child(\"answers\").on(\"child_added\", snapshot => {\n    const data = snapshot.val();\n    if (data === null || data === void 0 ? void 0 : data.answer) {\n      const pc = store.getState().participants[data.answer.userId].peerConnection;\n      const answerDescription = new RTCSessionDescription(data.answer);\n      pc.setRemoteDescription(answerDescription);\n    }\n  });\n  currentUserRef.child(\"answerCandidates\").on(\"child_added\", snapshot => {\n    const data = snapshot.val();\n    if (data.userId) {\n      const pc = store.getState().participants[data.userId].peerConnection;\n      pc.addIceCandidate(new RTCIceCandidate(data));\n    }\n  });\n};\nconst createAnswer = async (otherUserId, userId) => {\n  const pc = store.getState().participants[otherUserId].peerConnection;\n  const participantRef1 = participantRef.child(otherUserId);\n  pc.onicecandidate = event => {\n    event.candidate && participantRef1.child(\"answerCandidates\").push({\n      ...event.candidate.toJSON(),\n      userId: userId\n    });\n  };\n  const answerDescription = await pc.createAnswer();\n  await pc.setLocalDescription(answerDescription);\n  const answer = {\n    type: answerDescription.type,\n    sdp: answerDescription.sdp,\n    userId: userId\n  };\n  await participantRef1.child(\"answers\").push().set({\n    answer\n  });\n};","map":{"version":3,"names":["firepadRef","store","participantRef","child","updatePreference","userId","preference","currentParticipantRef","setTimeout","update","createOffer","peerConnection","receiverId","createdID","onicecandidate","event","candidate","push","toJSON","offerDescription","setLocalDescription","offer","sdp","type","set","initializeListensers","currentUserRef","on","snapshot","data","val","pc","getState","participants","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","answer","answerDescription","otherUserId","participantRef1"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/server/peerConnection.js"],"sourcesContent":["import firepadRef from \"./firebase\";\r\nimport { store } from \"../index\";\r\n\r\nconst participantRef = firepadRef.child(\"participants\");\r\n\r\nexport const updatePreference = (userId, preference) => {\r\n  const currentParticipantRef = participantRef\r\n    .child(userId)\r\n    .child(\"preferences\");\r\n  setTimeout(() => {\r\n    currentParticipantRef.update(preference);\r\n  });\r\n};\r\n\r\nexport const createOffer = async (peerConnection, receiverId, createdID) => {\r\n  const currentParticipantRef = participantRef.child(receiverId);\r\n  peerConnection.onicecandidate = (event) => {\r\n    event.candidate &&\r\n      currentParticipantRef\r\n        .child(\"offerCandidates\")\r\n        .push({ ...event.candidate.toJSON(), userId: createdID });\r\n  };\r\n\r\n  const offerDescription = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offerDescription);\r\n\r\n  const offer = {\r\n    sdp: offerDescription.sdp,\r\n    type: offerDescription.type,\r\n    userId: createdID,\r\n  };\r\n\r\n  await currentParticipantRef.child(\"offers\").push().set({ offer });\r\n};\r\n\r\nexport const initializeListensers = async (userId) => {\r\n  const currentUserRef = participantRef.child(userId);\r\n\r\n  currentUserRef.child(\"offers\").on(\"child_added\", async (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data?.offer) {\r\n      const pc =\r\n        store.getState().participants[data.offer.userId].peerConnection;\r\n      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\r\n      await createAnswer(data.offer.userId, userId);\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"offerCandidates\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data.userId) {\r\n      const pc = store.getState().participants[data.userId].peerConnection;\r\n      pc.addIceCandidate(new RTCIceCandidate(data));\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"answers\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data?.answer) {\r\n      const pc =\r\n        store.getState().participants[data.answer.userId].peerConnection;\r\n      const answerDescription = new RTCSessionDescription(data.answer);\r\n      pc.setRemoteDescription(answerDescription);\r\n    }\r\n  });\r\n\r\n  currentUserRef.child(\"answerCandidates\").on(\"child_added\", (snapshot) => {\r\n    const data = snapshot.val();\r\n    if (data.userId) {\r\n      const pc = store.getState().participants[data.userId].peerConnection;\r\n      pc.addIceCandidate(new RTCIceCandidate(data));\r\n    }\r\n  });\r\n};\r\n\r\nconst createAnswer = async (otherUserId, userId) => {\r\n  const pc = store.getState().participants[otherUserId].peerConnection;\r\n  const participantRef1 = participantRef.child(otherUserId);\r\n  pc.onicecandidate = (event) => {\r\n    event.candidate &&\r\n      participantRef1\r\n        .child(\"answerCandidates\")\r\n        .push({ ...event.candidate.toJSON(), userId: userId });\r\n  };\r\n\r\n  const answerDescription = await pc.createAnswer();\r\n  await pc.setLocalDescription(answerDescription);\r\n\r\n  const answer = {\r\n    type: answerDescription.type,\r\n    sdp: answerDescription.sdp,\r\n    userId: userId,\r\n  };\r\n\r\n  await participantRef1.child(\"answers\").push().set({ answer });\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}