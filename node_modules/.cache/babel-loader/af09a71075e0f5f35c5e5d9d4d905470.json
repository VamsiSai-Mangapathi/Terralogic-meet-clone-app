{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Vamsisai-2994\\\\REACT\\\\google-meet-clone\\\\src\\\\components\\\\MainScreen\\\\MainScreen.component.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from \"react\";\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\nimport Participants from \"../Participants/Participants.component\";\nimport \"./MainScreen.css\";\nimport { connect } from \"react-redux\";\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\nimport Join from \"./../Kyathi/Join\";\nimport firepadRef from \"../../server/firebase\";\nimport Welcome from \"./Welcome\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MainScreen = props => {\n  _s();\n  const isAdmin = window.location.hash === '#init' ? true : false;\n  const copy = `${window.location.origin}${`/login/?id=`}${firepadRef.key}`;\n  const [join, setJoin] = useState();\n  window.localStorage.setItem(\"url\", copy);\n  const [welcome, setwelcome] = useState(window.localStorage.getItem(\"refresh\"));\n  useEffect(() => {\n    if (isAdmin) {\n      setJoin(true);\n    } else {\n      setwelcome(true);\n    }\n  }, []);\n  const closejoinHandler = () => {\n    setJoin(false);\n  };\n  const closewelcomehandler = () => {\n    window.location.reload(true);\n    window.localStorage.setItem(\"refresh\", false);\n    setwelcome(false);\n  };\n  const participantRef = useRef(props.participants);\n  const onMicClick = micEnabled => {\n    if (props.stream) {\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\n      props.updateUser({\n        audio: micEnabled\n      });\n    }\n  };\n  const onVideoClick = videoEnabled => {\n    if (props.stream) {\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\n      props.updateUser({\n        video: videoEnabled\n      });\n    }\n  };\n  useEffect(() => {\n    participantRef.current = props.participants;\n  }, [props.participants]);\n  const updateStream = stream => {\n    for (let key in participantRef.current) {\n      const sender = participantRef.current[key];\n      if (sender.currentUser) continue;\n      const peerConnection = sender.peerConnection.getSenders().find(s => s.track ? s.track.kind === \"video\" : false);\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\n    }\n    props.setMainStream(stream);\n  };\n  const onScreenShareEnd = async () => {\n    const localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    });\n    localStream.getVideoTracks()[0].enabled = Object.values(props.currentUser)[0].video;\n    updateStream(localStream);\n    props.updateUser({\n      screen: false\n    });\n  };\n  const onScreenClick = async () => {\n    let mediaStream;\n    if (navigator.getDisplayMedia) {\n      mediaStream = await navigator.getDisplayMedia({\n        video: true\n      });\n    } else if (navigator.mediaDevices.getDisplayMedia) {\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true\n      });\n    } else {\n      mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          mediaSource: \"screen\"\n        }\n      });\n    }\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\n    updateStream(mediaStream);\n    props.updateUser({\n      screen: true\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-screen\",\n      children: [join && /*#__PURE__*/_jsxDEV(Join, {\n        onclose: closejoinHandler,\n        url: copy\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 18\n      }, this), welcome && /*#__PURE__*/_jsxDEV(Welcome, {\n        onclosewelcome: closewelcomehandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Participants, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"footer\",\n      children: /*#__PURE__*/_jsxDEV(MeetingFooter, {\n        onScreenClick: onScreenClick,\n        onMicClick: onMicClick,\n        onVideoClick: onVideoClick\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n};\n_s(MainScreen, \"xPM1ublUKd98IszyvW0bOslAfqY=\");\n_c = MainScreen;\nconst mapStateToProps = state => {\n  return {\n    stream: state.mainStream,\n    participants: state.participants,\n    currentUser: state.currentUser\n  };\n};\nconst mapDispatchToProps = dispatch => {\n  return {\n    setMainStream: stream => dispatch(setMainStream(stream)),\n    updateUser: user => dispatch(updateUser(user))\n  };\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\nvar _c;\n$RefreshReg$(_c, \"MainScreen\");","map":{"version":3,"names":["React","useRef","useEffect","useState","MeetingFooter","Participants","connect","setMainStream","updateUser","Join","firepadRef","Welcome","MainScreen","props","isAdmin","window","location","hash","copy","origin","key","join","setJoin","localStorage","setItem","welcome","setwelcome","getItem","closejoinHandler","closewelcomehandler","reload","participantRef","participants","onMicClick","micEnabled","stream","getAudioTracks","enabled","audio","onVideoClick","videoEnabled","getVideoTracks","video","current","updateStream","sender","currentUser","peerConnection","getSenders","find","s","track","kind","replaceTrack","onScreenShareEnd","localStream","navigator","mediaDevices","getUserMedia","Object","values","screen","onScreenClick","mediaStream","getDisplayMedia","mediaSource","onended","mapStateToProps","state","mainStream","mapDispatchToProps","dispatch","user"],"sources":["C:/Users/Vamsisai-2994/REACT/google-meet-clone/src/components/MainScreen/MainScreen.component.js"],"sourcesContent":["import React, { useRef, useEffect,useState } from \"react\";\r\nimport MeetingFooter from \"../MeetingFooter/MeetingFooter.component\";\r\nimport Participants from \"../Participants/Participants.component\";\r\nimport \"./MainScreen.css\";\r\nimport { connect } from \"react-redux\";\r\nimport { setMainStream, updateUser } from \"../../store/actioncreator\";\r\nimport Join from \"./../Kyathi/Join\";\r\nimport firepadRef from \"../../server/firebase\";\r\nimport Welcome from \"./Welcome\";\r\nconst MainScreen = (props) => {\r\n  const isAdmin = window.location.hash === '#init' ? true : false;\r\n  const copy= `${window.location.origin}${`/login/?id=`}${firepadRef.key}`;\r\n  const[join,setJoin]=useState();\r\n  window.localStorage.setItem(\"url\",copy);\r\n  \r\n  const [welcome,setwelcome]=useState(window.localStorage.getItem(\"refresh\"));\r\n  useEffect(()=>{\r\n    \r\n    if(isAdmin){\r\n     setJoin(true);\r\n    }\r\n    else{\r\n      setwelcome(true);\r\n    }\r\n  },[]);\r\n\r\n  \r\n  const closejoinHandler=()=>{\r\n    setJoin(false);\r\n  }\r\n\r\n  const closewelcomehandler=()=>{\r\n    window.location.reload(true);\r\n    window.localStorage.setItem(\"refresh\",false);\r\n    setwelcome(false);\r\n  }\r\n  const participantRef = useRef(props.participants);\r\n\r\n  const onMicClick = (micEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getAudioTracks()[0].enabled = micEnabled;\r\n      props.updateUser({ audio: micEnabled });\r\n    }\r\n  };\r\n  const onVideoClick = (videoEnabled) => {\r\n    if (props.stream) {\r\n      props.stream.getVideoTracks()[0].enabled = videoEnabled;\r\n      props.updateUser({ video: videoEnabled });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    participantRef.current = props.participants;\r\n  }, [props.participants]);\r\n\r\n  const updateStream = (stream) => {\r\n    for (let key in participantRef.current) {\r\n      const sender = participantRef.current[key];\r\n      if (sender.currentUser) continue;\r\n      const peerConnection = sender.peerConnection\r\n        .getSenders()\r\n        .find((s) => (s.track ? s.track.kind === \"video\" : false));\r\n      peerConnection.replaceTrack(stream.getVideoTracks()[0]);\r\n    }\r\n    props.setMainStream(stream);\r\n  };\r\n\r\n  const onScreenShareEnd = async () => {\r\n    const localStream = await navigator.mediaDevices.getUserMedia({\r\n      audio: true,\r\n      video: true,\r\n    });\r\n\r\n    localStream.getVideoTracks()[0].enabled = Object.values(\r\n      props.currentUser\r\n    )[0].video;\r\n\r\n    updateStream(localStream);\r\n\r\n    props.updateUser({ screen: false });\r\n  };\r\n\r\n  const onScreenClick = async () => {\r\n    let mediaStream;\r\n    if (navigator.getDisplayMedia) {\r\n      mediaStream = await navigator.getDisplayMedia({ video: true });\r\n    } else if (navigator.mediaDevices.getDisplayMedia) {\r\n      mediaStream = await navigator.mediaDevices.getDisplayMedia({\r\n        video: true,\r\n      });\r\n    } else {\r\n      mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { mediaSource: \"screen\" },\r\n      });\r\n    }\r\n\r\n    mediaStream.getVideoTracks()[0].onended = onScreenShareEnd;\r\n\r\n    updateStream(mediaStream);\r\n\r\n    props.updateUser({ screen: true });\r\n  };\r\n  return (\r\n    <div className=\"wrapper\">\r\n      <div className=\"main-screen\">\r\n        {join && <Join onclose={closejoinHandler} url={copy} />}\r\n        {welcome && <Welcome onclosewelcome={closewelcomehandler} /> }\r\n        <Participants />\r\n      </div>\r\n\r\n      <div className=\"footer\">\r\n        <MeetingFooter\r\n          onScreenClick={onScreenClick}\r\n          onMicClick={onMicClick}\r\n          onVideoClick={onVideoClick}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    stream: state.mainStream,\r\n    participants: state.participants,\r\n    currentUser: state.currentUser,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    setMainStream: (stream) => dispatch(setMainStream(stream)),\r\n    updateUser: (user) => dispatch(updateUser(user)),\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MainScreen);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}